<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CommonMark Simply Diff | Raymond Wang&#39;s CSE 15L Homepage</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-2V30EYKRT4"></script>
    <script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-2V30EYKRT4');</script>
    <meta name="description" content="Raymond Wang&#39;s CSE15L Homepage">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/CSE15L/assets/css/0.styles.ddc50994.css" as="style"><link rel="preload" href="/CSE15L/assets/js/app.51026b4e.js" as="script"><link rel="preload" href="/CSE15L/assets/js/2.357d2ac8.js" as="script"><link rel="preload" href="/CSE15L/assets/js/11.29fc1cd7.js" as="script"><link rel="prefetch" href="/CSE15L/assets/js/10.400ae63d.js"><link rel="prefetch" href="/CSE15L/assets/js/12.ae52fd7d.js"><link rel="prefetch" href="/CSE15L/assets/js/3.b18a4c16.js"><link rel="prefetch" href="/CSE15L/assets/js/4.71571eb7.js"><link rel="prefetch" href="/CSE15L/assets/js/5.b915a789.js"><link rel="prefetch" href="/CSE15L/assets/js/6.b10e6d35.js"><link rel="prefetch" href="/CSE15L/assets/js/7.15d6f8dd.js"><link rel="prefetch" href="/CSE15L/assets/js/8.2e5aa909.js"><link rel="prefetch" href="/CSE15L/assets/js/9.b97d7afd.js">
    <link rel="stylesheet" href="/CSE15L/assets/css/0.styles.ddc50994.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/CSE15L/" class="home-link router-link-active"><img src="https://i.imgur.com/LiFjrJl.png" alt="Raymond Wang's CSE 15L Homepage" class="logo"> <span class="site-name can-hide">Raymond Wang's CSE 15L Homepage</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/waymondrang/CSE15L" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/waymondrang/CSE15L" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/CSE15L/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/CSE15L/week_two.html" class="sidebar-link">Dear Incoming CSE 15L Students</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CSE15L/week_two.html#installing-visual-studio-code" class="sidebar-link">Installing Visual Studio Code</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_two.html#getting-connected" class="sidebar-link">Getting Connected</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_two.html#executing-commands" class="sidebar-link">Executing Commands</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_two.html#teleporting-files" class="sidebar-link">Teleporting Files</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_two.html#becoming-a-keymaker" class="sidebar-link">Becoming a Keymaker</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_two.html#optimizing-and-optimizing" class="sidebar-link">Optimizing and Optimizing</a></li></ul></li><li><a href="/CSE15L/week_four.html" class="sidebar-link">Begone, Bugs! Scram, Symptoms!</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CSE15L/week_four.html#unclosed-open-brackets" class="sidebar-link">Unclosed Open Brackets</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_four.html#parenthesis-inside-links" class="sidebar-link">Parenthesis Inside Links</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_four.html#ignoring-images" class="sidebar-link">Ignoring Images</a></li></ul></li><li><a href="/CSE15L/week_six.html" class="sidebar-link">SSHorten SSH</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CSE15L/week_six.html#no-more-emails" class="sidebar-link">No More Emails</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_six.html#demonstration-with-scp" class="sidebar-link">Demonstration with scp</a></li></ul></li><li><a href="/CSE15L/week_eight.html" class="sidebar-link">Snippets and Tests</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CSE15L/week_eight.html#snippet-1" class="sidebar-link">Snippet 1</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_eight.html#snippet-2" class="sidebar-link">Snippet 2</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_eight.html#snippet-3" class="sidebar-link">Snippet 3</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_eight.html#reflection" class="sidebar-link">Reflection</a></li></ul></li><li><a href="/CSE15L/week_ten.html" aria-current="page" class="active sidebar-link">CommonMark Simply Diff</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CSE15L/week_ten.html#saving-test-results" class="sidebar-link">Saving Test Results</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_ten.html#comparing-test-results" class="sidebar-link">Comparing Test Results</a></li><li class="sidebar-sub-header"><a href="/CSE15L/week_ten.html#analyzing-test-results" class="sidebar-link">Analyzing Test Results</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="commonmark-simply-diff"><a href="#commonmark-simply-diff" class="header-anchor">#</a> CommonMark Simply Diff</h1> <div class="label">Week 10 Lab Report</div> <p>This document will compare <a href="https://github.com/pvijay03/markdown-parse" target="_blank" rel="noopener noreferrer">our implementation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of markdown-parse against markdown-parse from the <a href="https://github.com/ucsd-cse15l-w22/markdown-parse" target="_blank" rel="noopener noreferrer">main repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> using tests from CommonMark.</p> <h2 id="saving-test-results"><a href="#saving-test-results" class="header-anchor">#</a> Saving Test Results</h2> <p>We modified the <code>script.sh</code> script to include the name of the file before calling <code>MarkdownParse</code>, as such.</p> <div class="language-sh extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-sh"><code><span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> test-files/*.md<span class="token punctuation">;</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$file</span>
    java MarkdownParse <span class="token variable">$file</span>
<span class="token keyword">done</span>
</code></pre></div><p>Then, when calling <code>script.sh</code>, we direct the output to <code>results.txt</code>, as such.</p> <div class="language- extra-class"><pre class="language-text"><code>bash script.sh &gt; results.txt
</code></pre></div><p>We perform the command twice, once in the directory for our implementation and once in the directory for the main implementation. This creates two <code>results.txt</code> files.</p> <div class="language-txt extra-class"><pre class="language-txt"><code>test-files/1.md
[]
test-files/10.md
[]
test-files/100.md
[]
... (1298 more lines)
</code></pre></div><p>Now that we have our results, we can compare them and detect differences between the implementations.</p> <h2 id="comparing-test-results"><a href="#comparing-test-results" class="header-anchor">#</a> Comparing Test Results</h2> <p>The <code>diff</code> command finds differences between two files, which is what we will use to find disagreeing results. We can output the results of <code>diff</code> to a text file for our convenience.</p> <div class="language- extra-class"><pre class="language-text"><code>diff markdown-parse-test-files/results.txt markdown-parse/results.txt &gt; differences.txt
</code></pre></div><p><code>markdown-parse-test-files</code> is the directory for our implementation while <code>markdown-parse</code> is the main implementation.</p> <p>Let's open <code>differences.txt</code> and analyze the results of <code>diff</code>.</p> <div class="language-txt extra-class"><pre class="language-txt"><code>92c92
&lt; []
---
&gt; [/foo]
270c270
&lt; [/bar* &quot;ti*tle&quot;]
---
&gt; []
492c492
&lt; [/f&amp;ouml;&amp;ouml; &quot;f&amp;ouml;&amp;ouml;&quot;]
---
&gt; []
... (many more lines)
</code></pre></div><p>Every fifth line indicates which lines in each file had differences. For example, the first difference was in line 92, where our implementation found no links while the main implementation did, <code>/foo</code>.</p> <h2 id="analyzing-test-results"><a href="#analyzing-test-results" class="header-anchor">#</a> Analyzing Test Results</h2> <h3 id="analysis-1"><a href="#analysis-1" class="header-anchor">#</a> Analysis #1</h3> <p>To find which markdown file is associated with the line differences in <code>differences.txt</code>, we can look into the <code>results.txt</code> file.</p> <p>For our first analysis, let us look at the test case difference found in line 96.</p> <p>Here is a snippet from <code>results.txt</code> from our implementation. Line 96 is highlighted, and we can tell that it is associated with the markdown file <code>14.md</code>.</p> <div class="language- extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-text"><code>...
test-files/138.md
[]
test-files/139.md
[]
test-files/14.md
[]
test-files/140.md
[]
test-files/141.md
[]
...
</code></pre></div><p>We can open <code>14.md</code> and start investigating.</p> <div class="language-md extra-class"><pre class="language-md"><code>\*not emphasized\*
\<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span> not a tag
\[not a link](/foo)
\`not code`
1\. not a list \* not a list
\# not a heading
\<span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">foo</span><span class="token punctuation">]</span><span class="token punctuation">:</span> /url <span class="token string">&quot;not a reference&quot;</span></span>
\<span class="token entity named-entity" title="&amp;ouml;">&amp;ouml;</span> not a character entity
</code></pre></div><p>Parsing the file's contents through the <a href="https://spec.commonmark.org/dingus/" target="_blank" rel="noopener noreferrer">commonmark.js dingus<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, no link elements are outputted.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
  *not emphasized* <span class="token entity named-entity" title="&lt;">&amp;lt;</span>br/<span class="token entity named-entity" title="&gt;">&amp;gt;</span> not a tag [not a link](/foo) `not code` 1. not a
  list * not a list # not a heading [foo]: /url “not a reference” <span class="token entity named-entity" title="&amp;">&amp;amp;</span>ouml; not
  a character entity
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>This indicates that our implementation was correct and the main implementation was incorrect, as the main implementation outputted <code>[/foo]</code>. Let's try to find out why.</p> <p>The main implementation of MarkdownParse does not check for escaped characters. Our implementation has a method that overrides the <code>indexOf</code> method to handle backslashes, shown below.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">indexOfUnescaped</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token class-name">String</span> search<span class="token punctuation">,</span> <span class="token keyword">int</span> startIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> currIndex <span class="token operator">=</span> startIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> backslashCount<span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        currIndex <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>search<span class="token punctuation">,</span> currIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        backslashCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> index <span class="token operator">=</span> currIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            index<span class="token operator">--</span><span class="token punctuation">;</span>
            backslashCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>backslashCount <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> currIndex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>indexOfUnescaped</code> method is implemented within our <code>getLinksFromLine</code> method,</p> <div class="language-java extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getLinksFromLine</span><span class="token punctuation">(</span><span class="token class-name">String</span> markdown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">int</span> nextOpenBracket <span class="token operator">=</span> <span class="token function">indexOfUnescaped</span><span class="token punctuation">(</span>markdown<span class="token punctuation">,</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">,</span> currentIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextOpenBracket <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> nextCloseBracket <span class="token operator">=</span> <span class="token function">indexOfUnescaped</span><span class="token punctuation">(</span>markdown<span class="token punctuation">,</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> nextOpenBracket<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> openParen <span class="token operator">=</span> <span class="token function">indexOfUnescaped</span><span class="token punctuation">(</span>markdown<span class="token punctuation">,</span> <span class="token string">&quot;(&quot;</span><span class="token punctuation">,</span> nextCloseBracket<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>openParen <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
</code></pre></div><p>The fix I would provide to the main implementation is a method similar to <code>indexOfEscaped</code>, where a check is performed on each character to ensure that it is not escaped.</p> <h3 id="analysis-2"><a href="#analysis-2" class="header-anchor">#</a> Analysis #2</h3> <p>Let us go back to <code>differences.txt</code> again. Next, I will analyze the difference between the implementations in line 492 of <code>results.txt</code>.</p> <div class="language-txt extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-txt"><code>92c92
&lt; []
---
&gt; [/foo]
270c270
&lt; [/bar* &quot;ti*tle&quot;]
---
&gt; []
492c492
&lt; [/f&amp;ouml;&amp;ouml; &quot;f&amp;ouml;&amp;ouml;&quot;]
---
&gt; []
... (many more lines)
</code></pre></div><p>We can tell that our implementation outputted some strange text that includes a space, while the main implementation did have any output. Neither implementation looks correct, but let's look at the markdown file associated with this line to dive deeper.</p> <p>Going into <code>results.txt</code>, we can tell that line 492 is associated with markdown file <code>32.md</code>.</p> <div class="language-txt extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-txt"><code>...
test-files/318.md
[]
test-files/319.md
[]
test-files/32.md
[/f&amp;ouml;&amp;ouml; &quot;f&amp;ouml;&amp;ouml;&quot;]
test-files/320.md
[]
test-files/321.md
[]
...
</code></pre></div><p>Lets open <code>32.md</code> and parse it through the <a href="https://spec.commonmark.org/dingus/" target="_blank" rel="noopener noreferrer">commonmark.js dingus<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-md extra-class"><pre class="language-md"><code><span class="token url">[<span class="token content">foo</span>](<span class="token url">/f&amp;ouml;&amp;ouml;</span> <span class="token string">&quot;f&amp;ouml;&amp;ouml;&quot;</span>)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/f%C3%B6%C3%B6<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>föö<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>We can tell that the markdown is supposed to output one link, with the link title being the text inside the double quotes in the parenthesis and the actual link being the text before the space inside the parenthesis.</p> <p>This is one type of link that neither implementation can handle. There are two problems.</p> <ol><li>Both MarkdownParse implementations do not have code to handle link titles, which is the text within the double quotes after the space.</li> <li>Both MarkdownParse implementations are missing the ability to encode to URL-format.</li></ol> <p>A solution to the first problem in our implementation would be to check if the link contained any spaces, and if there are, split the link by the space and validate that the second split element is enclosed by double quotes that are not escaped.</p> <p>A solution may look like this (changed lines are emphasized).</p> <div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code>    <span class="token comment">// ...</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>closeParen <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Check that this isn't an image link</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>nextOpenBracket <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> markdown<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>nextOpenBracket <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> substr <span class="token operator">=</span> markdown<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>openParen <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> closeParen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        substr <span class="token operator">=</span> substr<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\(.)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>substr<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> substr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">checkForDoubleQuotes</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            substr <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        toReturn<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>substr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    currentIndex <span class="token operator">=</span> closeParen <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> toReturn<span class="token punctuation">;</span>
</code></pre></div><p>To solve the first problem in the main implementation, the check for spaces within the potential link would have to be removed and the title checker from above would be added in the same fashion.</p> <p>A solution may look like this (changed lines are emphasized and old code is commented).</p> <div class="language-java extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token class-name">String</span> potentialLink <span class="token operator">=</span> markdown<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>openParen <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> closeParen<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// if(potentialLink.indexOf(&quot; &quot;) == -1 &amp;&amp; potentialLink.indexOf(&quot;\n&quot;) == -1) {</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>potentialLink<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>potentialLink<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> potentialLink<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">checkForDoubleQuotes</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        potentialLink <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    toReturn<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>potentialLink<span class="token punctuation">)</span><span class="token punctuation">;</span>
    currentIndex <span class="token operator">=</span> closeParen <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    currentIndex <span class="token operator">=</span> currentIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To solve the second problem in both implementations, a method must be constructed to parse the link text to URL-format before returning it. One could implement their own URLEncoder, or use the one in <a href="https://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/net/URLEncoder.html" target="_blank" rel="noopener noreferrer"><code>java.net.URLEncoder</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. However, <code>URLEncoder</code> will also encode the <code>/</code> in links, which is not something we want. Because of this, a custom method is needed to only URL encode the text around <code>/</code>.</p> <p>A solution in our implementation may look like this (changed lines are emphasized), where <code>encodeURL</code> would use the <code>URLEncoder</code> while preserving the <code>/</code> in the links.</p> <div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-java"><code>    <span class="token comment">// ...</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>closeParen <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Check that this isn't an image link</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>nextOpenBracket <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> markdown<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>nextOpenBracket <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> substr <span class="token operator">=</span> markdown<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>openParen <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> closeParen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        substr <span class="token operator">=</span> substr<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;\\\\(.)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>substr<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> substr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">checkForDoubleQuotes</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            substr <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        toReturn<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">encodeURL</span><span class="token punctuation">(</span>substr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    currentIndex <span class="token operator">=</span> closeParen <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> toReturn<span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/CSE15L/week_eight.html" class="prev">
        Snippets and Tests
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/CSE15L/assets/js/app.51026b4e.js" defer></script><script src="/CSE15L/assets/js/2.357d2ac8.js" defer></script><script src="/CSE15L/assets/js/11.29fc1cd7.js" defer></script>
  </body>
</html>
